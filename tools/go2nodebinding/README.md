# Go 2 Node.js bindings

This tools generates C++ wrappers for Go/Cgo exported functions.

It transforms:

```go
//export MyFunc
func MyFunc(arg1, arg2 *C.char, arg3 C.int) *C.char {
	...
}
```

into madness from https://nodejs.org/dist/latest/docs/api/addons.html:

```c++
// DO NOT EDIT: code is autogenerated by ./go2nodebinding from Go code.
// https://github.com/status-im/status-nodejs/tools/go2nodebinding

#include <node.h>

#include "../bin/libstatus.h"

namespace status {

using v8::Exception;
using v8::FunctionCallbackInfo;
using v8::Isolate;
using v8::Local;
using v8::Object;
using v8::String;
using v8::Number;
using v8::Value;


void _MyFunc(const FunctionCallbackInfo<Value>& args) {
	Isolate* isolate = args.GetIsolate();

	if (args.Length() != 3) {
		// Throw an Error that is passed back to JavaScript
		isolate->ThrowException(Exception::TypeError(
			String::NewFromUtf8(isolate, "Wrong number of arguments for MyFunc")));
		return;
	}

	// Check the argument types
	
	if (!args[0]->IsString()) { 
		isolate->ThrowException(Exception::TypeError(
			String::NewFromUtf8(isolate, "Wrong argument type for 'arg1'")));
		return;
	}
	if (!args[1]->IsString()) { 
		isolate->ThrowException(Exception::TypeError(
			String::NewFromUtf8(isolate, "Wrong argument type for 'arg2'")));
		return;
	}
	if (!args[2]->IsNumber()) { 
		isolate->ThrowException(Exception::TypeError(
			String::NewFromUtf8(isolate, "Wrong argument type for 'arg3'")));
		return;
	}

	
	String::Utf8Value arg0Obj(args[0]->ToString());
	char *arg0 = *arg0Obj;
	String::Utf8Value arg1Obj(args[1]->ToString());
	char *arg1 = *arg1Obj;
	int arg2 = args[2]->Int32Value();

	// Call exported Go function, which returns a C string
	char *c = MyFunc(arg0, arg1, arg2);

	Local<String> ret = String::NewFromUtf8(isolate, c);
	args.GetReturnValue().Set(ret);
	delete c;
}

void init(Local<Object> exports) {
	NODE_SET_METHOD(exports, "MyFunc", _MyFunc);
	
}

NODE_MODULE(NODE_GYP_MODULE_NAME, init)

}  // namespace status

```

# Installation

Go get it:

```
go get github.com/status-im/status-nodejs/tools/go2nodebinding
```

# Usage

Just feed a Go file, C++ code will be printed to the stdout:

```
go2nodebinding example/example.go > binding.cpp
```

In Go projects it's suggested to use from within `go:generate`.

# License

TBD
